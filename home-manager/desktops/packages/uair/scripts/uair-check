#!/usr/bin/env bash

state=$(uairctl fetch "{state}\n")

if [[ "$state" == "paused" ]]; then
    zenity_output=$(zenity --question \
      --title="checking in 🍅" --text \
      "noticed you might be off track, need help getting back?" \
      --extra-button="Unpause the pomo, lets do this" \
      --cancel-label="I'm wasting time, what should I do?" \
      --ok-label="My mind is cloudy, I need a meditation")
    
    zenity_exit_code=$?
    if [[ $zenity_exit_code -eq 0 ]]; then
        # ok-label: need meditation
        start-day
        xdg-open "https://coaching.healthygamer.gg/guide/meditation-tracks"
        uairctl jump med-prep
    elif [[ "$zenity_output" == Unpause* ]]; then
        # extra-button: unpause
        uairctl resume
    else
        # cancel-label: what should I do
        hyprctl dispatch workspace 1
        uairctl jump med-prep
        uairctl pause
        (
            echo "10" ; sleep 1
            echo "# Think about your main goals atm." ; sleep 3
            echo "20" ; sleep 3
            echo "30" ; sleep 3
            echo "# Are there any tasks that are missing?" ; sleep 3
            echo "40" ; sleep 3
            echo "50" ; sleep 3
            echo "# Its always good to get the easy ones out of the way first." ; sleep 3
            echo "60" ; sleep 3
            echo "70" ; sleep 3
            echo "# Urgent and Important > Urgent > Important > Neither." ; sleep 3
            echo "80" ; sleep 3
            echo "90" ; sleep 3
            echo "# Take a breath, be **conscious** to be in control." ; sleep 3
            echo "95" ; sleep 3
            echo "100" ; sleep 1
        ) | zenity \
          --progress \
          --title="what to do 🍅" \
          --percentage=0 \
          --auto-close \
          --no-cancel &> /dev/null
        uairzen ': 🌅 spend the next moment choosing what you want to accomplish next! 🧠'
    fi
fi
